#include <iostream>
#include <iomanip>
#include <conio.h>
#include <string>
#include "Account.h"
#include "Product.h"
using namespace std;

int getUserChoice(int, bool);

int main() {
	//創建帳號密碼
	Account account;
	cout << "創建少於等於20字元的帳號:";
	account.IDcheck();

	cout << "請創建少於等於20字元的密碼:";
	account.hidepassword();
	account.Cleanscreen();

	//確認密碼

	char checkwd;
	cout << "現在我要確認你是" << account.getuserid() << "的擁有者" << endl;
	cout << "密碼-->";
	cin >> checkwd;
	if (checkwd == account.getpassword())
		cout << "看來你是注定要當盤子了";
	else if (checkwd != account.getpassword()) {

		cout << "我記得你5秒前設定過.." << endl;
		if (checkwd == account.getpassword()) {
			cout << "希望下次見到你，你的記憶力能超越金魚" << endl;
		}
		else if (checkwd != account.getpassword()) {
			cout << "我記得你5秒前設定過.." << endl;
		}
	}
	;

	bool isEnglish = false; // 初始語言為中文

	// 創建商品陣列
	Product products[] = {
		Product("運動飲料", "Energy Drink", 25, 10,"瓶"),
		Product("牛奶", "Milk", 45, 10,"瓶"),
		Product("可樂", "Cola", 25, 10,"罐"),
		Product("紅茶", "Black Tea", 20, 10,"瓶"),
		Product("雪碧", "Sprite", 25, 10,"罐"),
		Product("薯片", "Chips", 35, 10,"包"),
		Product("巧克力","Chocolate",39,10,"片"),
		Product("點心麵","Noodle Snack",30,10,"包"),
		Product("口香糖","Chewing Gum",40,10,"包"),
		Product("泡麵","Instant Noodle",30,10,"碗"),
	};

	int numProducts = sizeof(products) / sizeof(products[0]);// 計算商品陣列的大小

	// 語言選擇
	int languageChoice;
	cout << "Select language (選擇語言):" << endl;
	cout << "1. English" << endl;
	cout << "2. 中文" << endl;
	cout << "Choice (選擇): ";
	cin >> languageChoice;

	while (languageChoice != 1 && languageChoice != 2) {
		cout << "Invalid choice. Please re-enter: ";
		cin >> languageChoice;
	}

	isEnglish = (languageChoice == 1);


	// 顯示商品選單
	products[0].displayMenu(isEnglish, products, numProducts);


	// 讓使用者選擇商品
	int choiceIndex = getUserChoice(numProducts, isEnglish);
	string choice = products[choiceIndex].getName();

	// 顯示商品庫存
	int stock = products[choiceIndex].getStock();
	cout << (isEnglish ? "Stock: " : "商品庫存: ") << stock << endl;

	// 讓使用者輸入購買數量
	int quantity;
	cout << (isEnglish ? "Quantity: " : "購買數量: ");
	cin >> quantity;

	// 計算總價格並顯示購買明細
	int totalPrice = products[choiceIndex].getPrice() * quantity;
	string productName = products[choiceIndex].getName();
	string productUnit = products[choiceIndex].getUnit(); // 取得單位
	cout << (isEnglish ? "You bought" : "您購買了") << " " << quantity << " " << productUnit << productName << "，"
		<< (isEnglish ? "and the total consumption is " : "總共消費") << totalPrice << " " << (isEnglish ? "dollars" : "元") << endl;


	// 更新商品庫存
	products[choiceIndex].updateStock(quantity);



	// 更新庫存量並顯示商品購買明細
	if (quantity > stock) {
		cout << (isEnglish ? "Insufficient stock" : "庫存不足") << endl;
	}
	else {
		products[choiceIndex].setStock(stock - quantity);
		cout << (isEnglish ? "Remaining stock: " : "商品剩餘: ") << products[choiceIndex].getStock() << endl;
	}
	return 0;
}

int getUserChoice(int size, bool isEnglish) {
	int choice;
	cout << (isEnglish ? "Select product number: " : "選擇商品編號: ");
	cin >> choice;
	while (choice < 1 || choice > size) {
		cout << (isEnglish ? "Invalid choice. Please re-enter: " : "無效的選擇。請重新輸入: ");
		cin >> choice;
	}
	return choice - 1; // 將索引轉換為陣列索引
}

